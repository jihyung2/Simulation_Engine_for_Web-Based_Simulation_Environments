<!DOCTYPE html>
<html>
<head>
    <title>Checkboxes and Input Transfer</title>
    <style>
        .container {
            margin-bottom: 10px;
        }
    </style>
</head>
<link rel="icon" href="data:;base64, iVBOPRw0KGgo=">
<body>
    <h1>Checkboxes and Input Transfer</h1>
    <form id="checkForm">
        <div class="container">
            <input type="checkbox" id="A" name="checkbox" value="A">
            <label for="A">A</label>
        </div>
        <div class="container">
            <input type="checkbox" id="B" name="checkbox" value="B">
            <label for="B">B</label>
        </div>
        <div class="container">
            <input type="checkbox" id="C" name="checkbox" value="C">
            <label for="C">C</label>
        </div>
        <div class="container">
            <input type="checkbox" id="D" name="checkbox" value="D">
            <label for="D">D</label>
        </div>
        <div class="container">
            <label for="port">Port number:</label>
            <input type="number" id="port" name="port" required>
        </div>
        <div class="container">
            <label for="username">Name:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <button type="submit">Run</button>
    </form>

    <div id="resultContainer">
        <!-- 결과를 표시할 컨테이너 -->
    </div>

    <script>
        const resultContainer = document.getElementById("resultContainer");

        // WebSocket 연결을 생성합니다.
        const socket = new WebSocket("ws://localhost:8700");

        // WebSocket 연결이 열릴 때 발생하는 이벤트 핸들러
        socket.onopen = function(event) {
            console.log("WebSocket 연결이 열렸습니다.");
        };

        // WebSocket 메시지를 받을 때 발생하는 이벤트 핸들러
        socket.onmessage = function(event) {
            // 받은 데이터를 원하는 방식으로 표시합니다.
            resultContainer.innerHTML = `<p>시뮬레이션 결과: ${event.data}</p>`;
        };

        // WebSocket 연결이 닫힐 때 발생하는 이벤트 핸들러
        socket.onclose = function(event) {
            console.log("WebSocket 연결이 닫혔습니다.");
        };

        document.getElementById("checkForm").onsubmit = async function(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const checkboxes = formData.getAll("checkbox");
            const port = formData.get("port");
            const username = formData.get("username");

            const sendData = {
                checkboxes: checkboxes,
                port: port,
                username: username
            };

            const response = await fetch("/start_simulation", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(sendData)
            });

            if (response.ok) {
                const data = await response.json();
                const redirect_url = data.redirect_url;
                window.location.href = redirect_url;
            } else {
                alert("Error: Could not send data!");
            }
        };
    </script>
</body>
</html>